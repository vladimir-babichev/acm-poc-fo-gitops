apiVersion: apps.open-cluster-management.io/v1
kind: Subscription
metadata:
  name: prometheus-stack-dev-westeu-1
  namespace: acm-poc-fo-gitops
  labels:
    acm-app: prometheus-stack
spec:
  channel: acm-poc-channel-fo-prometheus-helm/prometheus-community
  name: kube-prometheus-stack
  packageFilter:
    version: "13.13.0"
  placement:
    placementRef:
      kind: PlacementRule
      name: dev-westeu-1
  packageOverrides:
  - packageName: prometheus-stack
    packageOverrides:
      - path: spec
        value:
          kubeControllerManager.enabled: false
          coreDns.enabled: false
          kubeEtcd.enabled: false
          kubeScheduler.enabled: false
          kubeProxy.enabled: false
          kubeStateMetrics.enabled: false
          nodeExporter.enabled: false

          prometheus:
            prometheusSpec:
              serviceMonitorSelectorNilUsesHelmValues: false
              ruleSelectorNilUsesHelmValues: false
              ruleSelector:
                matchLabels:
                  release: prometheus-operator
              securityContext:
                runAsGroup: 1001070001
                runAsNonRoot: true
                runAsUser: 1001070001
                fsGroup: 1001070001
            ingress:
              enabled: false
              annotations:
                kubernetes.io/ingress.class: nginx
              hosts:
                - prometheus.host
              paths:
                - "/"
          grafana:
            enabled: false
            ingress:
              enabled: false
              annotations:
                kubernetes.io/ingress.class: nginx
              hosts:
                - grafana.host
              path: "/"
            sidecar:
              dashboards:
                searchNamespace: ALL
            # Configure dashboard provider to pre-install dashboards
            dashboardProviders:
              dashboardproviders.yaml:
                apiVersion: 1
                providers:
                - name: 'default'
                  orgId: 1
                  folder: ''
                  type: file
                  disableDeletion: false
                  editable: true
                  options:
                    path: /var/lib/grafana/dashboards/default
            # List of dashbords we want to pre-installed dashboards
            dashboards:
              default:
                argocd-dashboard:
                  url: https://raw.githubusercontent.com/argoproj/argo-cd/master/examples/dashboard.json
            adminPassword: prometheus-operator
            grafana.ini:
              server:
                enable_gzip: "true"
              analytics:
                check_for_updates: false
                reporting_enabled: false
              auth.anonymous:
                enabled: true
          alertmanager:
            enabled: false

          # Fixes https://github.com/prometheus-community/helm-charts/issues/418
          prometheusOperator:
            enabled: false
            # admissionWebhooks:
            #   enabled: false
            # tls:
            #   enabled: false
